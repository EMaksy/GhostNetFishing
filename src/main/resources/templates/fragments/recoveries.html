<div xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
     th:fragment="recoveries"
     class="recoveries-fragment">

  <div class="recovery-panel card">
    <div class="recovery-panel__header">
      <span>Open Recoveries</span>
    </div>

    <div class="recovery-panel__list">
      <div th:each="recovery : ${openRecoveries}"
           class="recovery-card card shadow-sm">
        <div class="recovery-card__status">
          <span class="label">Status:</span>
          <span class="badge"
                th:classappend="${#strings.toLowerCase(recovery.status?.name())}"
                th:text="${recovery.status}"></span>
        </div>
        <div class="recovery-card__body">
          <div class="row-line">
            <span class="label">Location:</span>
            <span th:text="${recovery.latitude}"></span>,
            <span th:text="${recovery.longitude}"></span>
          </div>
          <div class="row-line">
            <span class="label">Size:</span>
            <span th:text="${recovery.size}"></span>
          </div>
          <div class="row-line" th:if="${recovery.createdAt != null}">
            <span class="label">Reported on:</span>
            <span th:text="${#temporals.format(recovery.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
          </div>
          <div class="row-line">
            <span class="label">Reporter:</span>
            <span th:text="${recovery.reporter != null ? recovery.reporter.name : 'Anonymous'}"></span>
          </div>
          <div class="row-line"
               th:if="${recovery.reporter != null and recovery.reporter.phone != null and !#strings.isEmpty(recovery.reporter.phone)}">
            <span class="label">Reporter phone:</span>
            <span th:text="${recovery.reporter.phone}"></span>
          </div>
          <div class="row-line" th:if="${recovery.rescuer != null}">
            <span class="label">Rescuer:</span>
            <span th:text="${recovery.rescuer.name}"></span>
          </div>
        </div>
        <div class="recovery-card__actions"
             th:if="${recovery.status == T(com.emaksy.ghostnet.app.model.GhostNetStatus).REPORTED and recovery.rescuer == null}">
          <div sec:authorize="isAuthenticated()">
            <form th:action="@{/recoveries/{id}/join(id=${recovery.id})}" method="post">
              <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}"/>
              <button class="btn btn-sm btn-success" type="submit">Join Recovery</button>
            </form>
          </div>
          <div sec:authorize="!isAuthenticated()">
            <a class="btn btn-sm btn-primary" th:href="@{/login}">Sign in to recover</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
